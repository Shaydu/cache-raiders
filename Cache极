import SwiftUI
import CoreNFC

// MARK: - NFC Scan Only View
/// View for scanning existing NFC tokens and registering them as finds
/// This is different from OpenGameNFCScannerView which creates NEW objects
/// This view ONLY scans existing tokens and marks them as found
struct NFCScanOnlyView: View {
    @Environment(\.dismiss) var dismiss
    @ObservedObject var locationManager: LootBoxLocationManager
    @ObservedObject var userLocationManager: UserLocationManager
    private let nfcService = NFCService.shared

    @State private var isScanning = false
    @State private var scanResult: NFCService.NFCResult?
    @State private var errorMessage: String?
    @State private var currentStep: ScanningStep = .ready
    @State private var foundObject: LootBoxLocation?

    enum ScanningStep {
        case ready          // Ready to scan
        case scanning       // Currently scanning
        case processing     // Processing scanned token
        case success        // Successfully scanned and registered
        case notFound       // NFC token not found in database
        case error          // Error occurred during scanning
    }

    private var stepDescription: String {
        switch currentStep {
        case .ready:
            return "Tap to scan an NFC token and register your find"
        case .scanning:
            return "Hold your iPhone near an NFC token"
        case .processing:
            return "Looking up scanned token in database..."
        case .success:
            return "Treasure scanned successfully!"
        case .notFound:
            return "NFC token not found in database"
        case .error:
            return "An error occurred"
        }
    }

    var body: some View {
        NavigationView {
            VStack(spacing: 20) {
                // Header
                VStack(spacingÊûÅ







