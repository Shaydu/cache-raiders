<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cache Raiders - Object Admin</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Application CSS -->
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div id="sidebar">
        <div>
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                <img src="/static/cache-raiders-logo-v5.png" alt="Cache Raiders Logo" style="width: 120px; height: 120px; border-radius: 10px;" onerror="this.style.display='none'">
                <h1 style="margin: 0;">Cache Raiders</h1>
            </div>
            <p style="color: #999; font-size: 12px;">Click on the map to place new objects</p>
        </div>
        
        <div class="section">
            <h2>Create New Object</h2>
            <form id="objectForm">
                <div class="form-group">
                    <label for="objectName">Name</label>
                    <input type="text" id="objectName" placeholder="Will auto-fill when type is selected" required>
                </div>
                
                <div class="form-group">
                    <label for="objectType">Loot Type</label>
                    <select id="objectType" class="loot-type-select" required>
                        <option value="">Select type...</option>
                        <option value="Chalice">Chalice</option>
                        <option value="Temple Relic">Temple Relic</option>
                        <option value="Treasure Chest">Treasure Chest</option>
                        <option value="Loot Chest">Loot Chest</option>
                        <option value="Loot Cart">Loot Cart</option>
                        <option value="Mysterious Sphere">Mysterious Sphere</option>
                        <option value="Mysterious Cube">Mysterious Cube</option>
                        <option value="Turkey">Turkey</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="objectRadius">Radius (meters)</label>
                    <input type="number" id="objectRadius" value="5.0" min="1" max="100" step="0.5" required>
                </div>
                
                <div class="info-box">
                    <strong>Location:</strong><br>
                    <span id="locationInfo">Click on map to set location</span>
                </div>
                
                <button type="submit" id="createBtn">Place Loot</button>
            </form>
            
            <div id="statusMessage"></div>
        </div>
        
        <div class="section">
            <div class="section-header">
                <h2>Statistics</h2>
                <button class="btn-refresh" onclick="StatsManager.refreshStats()" title="Refresh Stats">ğŸ”„</button>
            </div>
            <div class="stats" id="stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalObjects">-</div>
                    <div class="stat-label">Total Objects</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="foundObjects">-</div>
                    <div class="stat-label">Found</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="unfoundObjects">-</div>
                    <div class="stat-label">Unfound</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgFinds">-</div>
                    <div class="stat-label">AVG Finds</div>
                </div>
            </div>
            
            <div id="typeCounts" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #444;">
                <h3 style="margin: 0 0 10px 0; font-size: 14px; color: #ccc;">Loot Plunder Count</h3>
                <div id="typeCountsList" style="display: flex; flex-direction: column; gap: 6px;">
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">
                <h2>ğŸ† Leaderboard</h2>
                <button class="btn-refresh" onclick="StatsManager.refreshStats()" title="Refresh Leaderboard">ğŸ”„</button>
            </div>
            <div class="leaderboard" id="leaderboard">
                <div class="loading">Loading leaderboard...</div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">
                <h2>ğŸ‘¥ Player Management</h2>
                <button class="btn-refresh" onclick="PlayersManager.loadPlayers()" title="Refresh Players">ğŸ”„</button>
            </div>
            
            <div class="filter-controls">
                <label>
                    <input type="checkbox" id="showDisconnectedPlayers" checked onchange="PlayersManager.loadPlayers()">
                    <span>Show disconnected players</span>
                </label>
            </div>
            <div class="objects-list" id="playersList">
                <div class="loading">Loading players...</div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">
                <h2>Loot Management</h2>
                <button class="btn-refresh" onclick="ObjectsManager.loadObjects()" title="Refresh List">ğŸ”„</button>
            </div>
            <div class="objects-list" id="objectsList">
                <div class="loading">Loading objects...</div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <h2>âš™ï¸ Settings</h2>
            </div>
            <div class="form-group">
                <label for="locationUpdateInterval">Location Update Frequency</label>
                <select id="locationUpdateInterval" class="loot-type-select" onchange="SettingsManager.updateLocationInterval()">
                    <option value="500">0.5 seconds</option>
                    <option value="1000" selected>1 second</option>
                    <option value="3000">3 seconds</option>
                    <option value="5000">5 seconds</option>
                    <option value="10000">10 seconds</option>
                    <option value="30000">30 seconds</option>
                    <option value="60000">60 seconds</option>
                </select>
                <p style="color: #999; font-size: 11px; margin-top: 5px;">Controls how often iOS devices send location updates and admin panel polls for updates</p>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">
                <h2>ğŸ“± Server Connection</h2>
                <button class="btn-refresh" onclick="QRCodeManager.initQRCode()" title="Refresh QR Code">ğŸ”„</button>
            </div>
            <p style="color: #ccc; font-size: 12px; margin-bottom: 10px;">Scan this QR code with your iOS app to connect:</p>
            <div id="qrcodeContainer" style="text-align: center; margin: 15px 0; min-height: 220px; display: flex; align-items: center; justify-content: center; position: relative;">
                <div style="position: relative; display: inline-block;">
                    <img id="qrcode" src="/api/qrcode" alt="Server QR Code" style="background: white; padding: 10px; border-radius: 8px; display: inline-block; max-width: 100%;" onerror="QRCodeManager.handleQRCodeError()">
                    <button onclick="QRCodeManager.initQRCode()" style="position: absolute; bottom: 8px; right: 8px; background: rgba(0, 0, 0, 0.7); border: 1px solid #666; color: #fff; padding: 4px 6px; border-radius: 4px; cursor: pointer; font-size: 10px; display: flex; align-items: center; justify-content: center; width: 24px; height: 24px; backdrop-filter: blur(4px);" title="Regenerate QR Code">
                        <span style="font-size: 12px;">ğŸ”„</span>
                    </button>
                </div>
            </div>
            <div id="serverAddressDisplay" style="margin: -10px 0 10px 0; padding: 6px 0; width: 100%; max-width: 100%; overflow: hidden;">
                <div style="display: flex; align-items: center; gap: 6px; width: 100%; max-width: 100%;">
                    <button onclick="QRCodeManager.copyServerURL()" style="width: auto !important; background: transparent; border: none; color: #999; padding: 0; margin: 0; cursor: pointer; font-size: 14px; display: flex; align-items: center; flex-shrink: 0; line-height: 1;" title="Copy URL">
                        <span>ğŸ“‹</span>
                    </button>
                    <span id="serverAddressText" style="color: #fff; font-size: 13px; font-family: monospace; white-space: nowrap; font-weight: 500; letter-spacing: 0.5px; flex-shrink: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis;">Loading...</span>
                </div>
            </div>
            <div style="margin: 10px 0; display: none;">
                <label style="display: block; margin-bottom: 5px; font-size: 12px; color: #ccc;">Server URL:</label>
                <input type="text" id="serverURL" readonly style="width: 100%; padding: 8px; background: #1a1a1a; border: 1px solid #444; border-radius: 4px; color: #fff; font-size: 12px; font-family: monospace;" value="Loading...">
            </div>
            <div style="margin: 15px 0;">
                <button onclick="WebSocketManager.testConnection()" style="width: 100%; padding: 10px; background: #444; color: #fff; border: 1px solid #666; border-radius: 4px; cursor: pointer; font-size: 14px; transition: background 0.2s;" onmouseover="this.style.background='#555'" onmouseout="this.style.background='#444'" id="wsTestBtn">
                    ğŸ§ª Test WebSocket Connection
                </button>
                <div id="wsTestResult" style="margin-top: 10px; padding: 10px; border-radius: 4px; display: none; font-size: 12px;"></div>
            </div>
            <p style="color: #999; font-size: 11px; margin-top: 10px; font-style: italic;">
                Note: Use the network IP address shown above (not localhost) when connecting from iOS devices on the same network.
            </p>
        </div>
        
        <div class="section">
            <div class="section-header">
                <h2>ğŸ” Connection Diagnostics</h2>
                <button class="btn-refresh" onclick="DiagnosticsManager.runFullDiagnostic()" title="Run Full Diagnostic">ğŸ”„</button>
            </div>
            <div style="margin-bottom: 15px;">
                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <button onclick="DiagnosticsManager.pingServer()" 
                            style="flex: 1; min-width: 120px; padding: 10px; background: #4caf50; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold;">
                        ğŸ–¥ï¸ Ping Server
                    </button>
                    <button onclick="DiagnosticsManager.pingAllClients()" 
                            style="flex: 1; min-width: 120px; padding: 10px; background: #2196f3; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold;">
                        ğŸ“± Ping All Clients
                    </button>
                    <button onclick="DiagnosticsManager.testMultiplePorts(window.location.hostname, [5001, 5000, 8080, 3000, 8000])" 
                            style="flex: 1; min-width: 120px; padding: 10px; background: #9c27b0; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold;">
                        ğŸ”Œ Test Ports
                    </button>
                    <button onclick="DiagnosticsManager.clearResults()" 
                            style="flex: 1; min-width: 120px; padding: 10px; background: #666; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold;">
                        ğŸ—‘ï¸ Clear Results
                    </button>
                </div>
            </div>
            <div id="diagnosticResult" style="display: none; padding: 10px; border-radius: 4px; margin-bottom: 10px; font-size: 12px;"></div>
            <div style="margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3 style="margin: 0; font-size: 14px; color: #ccc;">Connected Clients</h3>
                    <button onclick="DiagnosticsManager.refreshConnectedClients()" 
                            style="background: #2196f3; color: #fff; border: none; border-radius: 4px; padding: 4px 8px; font-size: 11px; cursor: pointer; white-space: nowrap;">
                        ğŸ”„ Refresh
                    </button>
                </div>
                <div id="diagnosticConnectedClients" style="max-height: 200px; overflow-y: auto;">
                    <div class="loading">Loading connected clients...</div>
                </div>
            </div>
            <div>
                <h3 style="margin: 0 0 10px 0; font-size: 14px; color: #ccc;">Ping Results</h3>
                <div id="diagnosticResults" style="max-height: 300px; overflow-y: auto; background: #1a1a1a; border-radius: 4px; padding: 10px;">
                    <div class="loading">No ping results yet</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>âš™ï¸ Map Settings</h2>
            <div class="form-group">
                <label style="display: block; margin-bottom: 8px; color: #ccc; font-size: 14px;">Map Style</label>
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; background: #1a1a1a; border-radius: 4px; transition: background 0.2s;" 
                           onmouseover="this.style.background='#2a2a2a'" 
                           onmouseout="this.style.background='#1a1a1a'">
                        <input type="radio" name="mapStyle" value="standard" id="mapStyleStandard" checked onchange="MapManager.setMapStyle('standard')">
                        <span>ğŸ—ºï¸ Standard (Google Maps style)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 8px; background: #1a1a1a; border-radius: 4px; transition: background 0.2s;" 
                           onmouseover="this.style.background='#2a2a2a'" 
                           onmouseout="this.style.background='#1a1a1a'">
                        <input type="radio" name="mapStyle" value="pirate" id="mapStylePirate" onchange="MapManager.setMapStyle('pirate')">
                        <span>ğŸ´â€â˜ ï¸ Pirate Map (Treasure Map style)</span>
                    </label>
                </div>
            </div>
        </div>
    </div>
    
    <div id="map"></div>
    
    <!-- Modal for object details -->
    <div id="objectModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Object Details</h2>
                <button class="modal-close" onclick="ModalManager.closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <div class="loading">Loading object details...</div>
            </div>
        </div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Google Maps JavaScript API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFw0Qbyq9zTFTd-tUY6d-s6U4ZUwwQZb8"></script>
    
    <!-- Leaflet Google Mutant Plugin (for Google Maps integration with Leaflet) -->
    <script src="https://unpkg.com/leaflet.gridlayer.googlemutant@latest/dist/Leaflet.GoogleMutant.js"></script>
    
    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <!-- QR Code is generated server-side, no CDN needed -->
    
    <!-- Application JavaScript Modules -->
    <!-- Load in dependency order -->
    <script src="/static/js/config.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/ui.js"></script>
    <script src="/static/js/settings.js"></script>
    <script src="/static/js/map.js"></script>
    <script src="/static/js/websocket.js"></script>
    <script src="/static/js/userLocations.js"></script>
    <script src="/static/js/stats.js"></script>
    <script src="/static/js/players.js"></script>
    <script src="/static/js/qrCode.js"></script>
    <script src="/static/js/modal.js"></script>
    <script src="/static/js/objects.js"></script>
    <script src="/static/js/diagnostics.js"></script>
    <script src="/static/js/main.js"></script>
</body>
</html>
