<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CacheRaiders - Object Admin</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Application CSS -->
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div id="sidebar">
        <div>
            <h1>üó∫Ô∏è CacheRaiders Admin</h1>
            <p style="color: #999; font-size: 12px;">Click on the map to place new objects</p>
            <button class="btn-secondary" style="margin-top: 10px;" onclick="UI.centerOnUserLocation()">
                Center on user location
            </button>
        </div>
        
        <div class="section">
            <h2>Create New Object</h2>
            <form id="objectForm">
                <div class="form-group">
                    <label for="objectName">Name <span style="color: #999; font-size: 11px;">(auto-filled, editable)</span></label>
                    <input type="text" id="objectName" placeholder="Will auto-fill when type is selected" required>
                </div>
                
                <div class="form-group">
                    <label for="objectType">Type</label>
                    <select id="objectType" required>
                        <option value="">Select type...</option>
                        <option value="Chalice">Chalice</option>
                        <option value="Temple Relic">Temple Relic</option>
                        <option value="Treasure Chest">Treasure Chest</option>
                        <option value="Loot Chest">Loot Chest</option>
                        <option value="Loot Cart">Loot Cart</option>
                        <option value="Mysterious Sphere">Mysterious Sphere</option>
                        <option value="Mysterious Cube">Mysterious Cube</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="objectRadius">Radius (meters)</label>
                    <input type="number" id="objectRadius" value="5.0" min="1" max="100" step="0.5" required>
                </div>
                
                <div class="info-box">
                    <strong>Location:</strong><br>
                    <span id="locationInfo">Click on map to set location</span>
                </div>
                
                <button type="submit" id="createBtn">Create Object</button>
            </form>
            
            <div id="statusMessage"></div>
        </div>
        
        <div class="section">
            <h2>Statistics</h2>
            <div class="stats" id="stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalObjects">-</div>
                    <div class="stat-label">Total Objects</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="foundObjects">-</div>
                    <div class="stat-label">Found</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="unfoundObjects">-</div>
                    <div class="stat-label">Unfound</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalFinds">-</div>
                    <div class="stat-label">Total Finds</div>
                </div>
            </div>
            <button class="btn-secondary" onclick="StatsManager.refreshStats()">Refresh Stats</button>
        </div>
        
        <div class="section">
            <h2>üèÜ Leaderboard</h2>
            <button class="btn-secondary" onclick="StatsManager.refreshStats()">Refresh Leaderboard</button>
            <div class="leaderboard" id="leaderboard">
                <div class="loading">Loading leaderboard...</div>
            </div>
        </div>
        
        <div class="section">
            <h2>üë• Player Management</h2>
            <button class="btn-secondary" onclick="PlayersManager.loadPlayers()">Refresh Players</button>
            <div class="filter-controls">
                <label>
                    <input type="checkbox" id="showDisconnectedPlayers" checked onchange="PlayersManager.loadPlayers()">
                    <span>Show disconnected players</span>
                </label>
            </div>
            <div class="objects-list" id="playersList">
                <div class="loading">Loading players...</div>
            </div>
        </div>
        
        <div class="section">
            <h2>Existing Objects</h2>
            <button class="btn-secondary" onclick="ObjectsManager.loadObjects()">Refresh List</button>
            <div class="objects-list" id="objectsList">
                <div class="loading">Loading objects...</div>
            </div>
        </div>
        
        <div class="section">
            <h2>üì± Server Connection</h2>
            <p style="color: #ccc; font-size: 12px; margin-bottom: 10px;">Scan this QR code with your iOS app to connect:</p>
            <div id="qrcodeContainer" style="text-align: center; margin: 15px 0; min-height: 220px; display: flex; align-items: center; justify-content: center;">
                <img id="qrcode" src="/api/qrcode" alt="Server QR Code" style="background: white; padding: 10px; border-radius: 8px; display: inline-block; max-width: 100%;" onerror="QRCodeManager.handleQRCodeError()">
            </div>
            <div style="margin: 10px 0;">
                <label style="display: block; margin-bottom: 5px; font-size: 12px; color: #ccc;">Server URL:</label>
                <input type="text" id="serverURL" readonly style="width: 100%; padding: 8px; background: #1a1a1a; border: 1px solid #444; border-radius: 4px; color: #fff; font-size: 12px; font-family: monospace;" value="Loading...">
            </div>
            <button class="btn-secondary" onclick="QRCodeManager.copyServerURL()" style="margin-top: 5px;">
                üìã Copy URL
            </button>
            <button class="btn-secondary" onclick="QRCodeManager.initQRCode()" style="margin-top: 5px;">
                üîÑ Regenerate QR Code
            </button>
            <p style="color: #999; font-size: 11px; margin-top: 10px; font-style: italic;">
                Note: Use the network IP address shown above (not localhost) when connecting from iOS devices on the same network.
            </p>
        </div>
    </div>
    
    <div id="map"></div>
    
    <!-- Modal for object details -->
    <div id="objectModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Object Details</h2>
                <button class="modal-close" onclick="ModalManager.closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <div class="loading">Loading object details...</div>
            </div>
        </div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <!-- QR Code is generated server-side, no CDN needed -->
    
    <!-- Application JavaScript Modules -->
    <!-- Load in dependency order -->
    <script src="/static/js/config.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/ui.js"></script>
    <script src="/static/js/map.js"></script>
    <script src="/static/js/websocket.js"></script>
    <script src="/static/js/userLocations.js"></script>
    <script src="/static/js/stats.js"></script>
    <script src="/static/js/players.js"></script>
    <script src="/static/js/qrCode.js"></script>
    <script src="/static/js/modal.js"></script>
    <script src="/static/js/objects.js"></script>
    <script src="/static/js/main.js"></script>
</body>
</html>
